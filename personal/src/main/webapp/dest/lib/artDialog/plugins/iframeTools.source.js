/*!
 * artDialog iframeTools
 * Date: 2011-11-25 13:54
 * http://code.google.com/p/artdialog/
 * (c) 2009-2011 TangBin, http://www.planeArt.cn
 *
 * This is licensed under the GNU LGPL, version 2.1 or later.
 * For details, see: http://creativecommons.org/licenses/LGPL/2.1/
 */

!function(t,n,e,o){var i,a,c,r="@ARTDIALOG.DATA",l="@ARTDIALOG.OPEN",d="@ARTDIALOG.OPENER",u=n.name=n.name||"@ARTDIALOG.WINNAME"+ +new Date,s=n.VBArray&&!n.XMLHttpRequest;t(function(){!n.jQuery&&"BackCompat"===document.compatMode&&alert('artDialog Error: document.compatMode === "BackCompat"')});var f=e.top=function(){var t=n,e=function(t){try{var e=n[t].document;e.getElementsByTagName}catch(t){return!1}return n[t].artDialog&&0===e.getElementsByTagName("frameset").length};return e("top")?t=n.top:e("parent")&&(t=n.parent),t}();e.parent=f,i=f.artDialog,c=function(){return i.defaults.zIndex},e.data=function(t,n){var i=e.top,a=i[r]||{};return i[r]=a,n===o?a[t]:(a[t]=n,a)},e.removeData=function(t){var n=e.top[r];n&&n[t]&&delete n[t]},e.through=a=function(){var t=i.apply(this,arguments);return f!==n&&(e.list[t.config.id]=t),t},f!==n&&t(n).bind("unload",function(){var t,n=e.list;for(var o in n)n[o]&&(t=n[o].config,t&&(t.duration=0),n[o].close())}),e.open=function(i,r,u){r=r||{};var f,p,m,h,v,y,g,x,w,b=e.top,D="position:absolute;left:-9999em;top:-9999em;border:none 0;background:transparent",k="width:100%;height:100%;border:none 0";if(u===!1){var I=+new Date,T=i.replace(/([?&])_=[^&]*/,"$1_="+I);i=T+(T===i?(/\?/.test(i)?"&":"?")+"_="+I:"")}var A=function(){var n,e,o=p.content.find(".aui_loading"),i=f.config;m.addClass("aui_state_full"),o&&o.hide();try{x=v.contentWindow,g=t(x.document),w=x.document.body}catch(t){return v.style.cssText=k,i.follow?f.follow(i.follow):f.position(i.left,i.top),r.init&&r.init.call(f,x,b),void(r.init=null)}n="auto"===i.width?g.width()+(s?0:parseInt(t(w).css("marginLeft"))):i.width,e="auto"===i.height?g.height():i.height,setTimeout(function(){v.style.cssText=k},0),f.size(n,e),i.follow?f.follow(i.follow):f.position(i.left,i.top),r.init&&r.init.call(f,x,b),r.init=null},z={zIndex:c(),init:function(){f=this,p=f.DOM,h=p.main,m=p.content,v=f.iframe=b.document.createElement("iframe"),v.src=i,v.name="Open"+f.config.id,v.style.cssText=D,v.setAttribute("frameborder",0,0),v.setAttribute("allowTransparency",!0),y=t(v),f.content().appendChild(v),x=v.contentWindow;try{x.name=v.name,e.data(v.name+l,f),e.data(v.name+d,n)}catch(t){}y.bind("load",A)},close:function(){if(y.css("display","none").unbind("load",A),r.close&&r.close.call(this,v.contentWindow,b)===!1)return!1;m.removeClass("aui_state_full"),y[0].src="about:blank",y.remove();try{e.removeData(v.name+l),e.removeData(v.name+d)}catch(t){}}};"function"==typeof r.ok&&(z.ok=function(){return r.ok.call(f,v.contentWindow,b)}),"function"==typeof r.cancel&&(z.cancel=function(){return r.cancel.call(f,v.contentWindow,b)}),delete r.content;for(var _ in r)z[_]===o&&(z[_]=r[_]);return a(z)},e.open.api=e.data(u+l),e.opener=e.data(u+d)||n,e.open.origin=e.opener,e.close=function(){var t=e.data(u+l);return t&&t.close(),!1},f!=n&&t(document).bind("mousedown",function(){var t=e.open.api;t&&t.zIndex()}),e.load=function(n,e,i){i=i||!1;var r=e||{},l={zIndex:c(),init:function(e){var o=this;o.config;t.ajax({url:n,success:function(t){o.content(t),r.init&&r.init.call(o,e)},cache:i})}};delete e.content;for(var d in r)l[d]===o&&(l[d]=r[d]);return a(l)},e.alert=function(t,n){return a({id:"Alert",zIndex:c(),icon:"warning",fixed:!0,lock:!0,content:t,ok:!0,close:n})},e.confirm=function(t,n,e){return a({id:"Confirm",zIndex:c(),icon:"question",fixed:!0,lock:!0,opacity:.1,content:t,ok:function(t){return n.call(this,t)},cancel:function(t){return e&&e.call(this,t)}})},e.prompt=function(t,n,e){e=e||"";var o;return a({id:"Prompt",zIndex:c(),icon:"question",fixed:!0,lock:!0,opacity:.1,content:['<div style="margin-bottom:5px;font-size:12px">',t,"</div>","<div>",'<input value="',e,'" style="width:18em;padding:6px 4px" />',"</div>"].join(""),init:function(){o=this.DOM.content.find("input")[0],o.select(),o.focus()},ok:function(t){return n&&n.call(this,o.value,t)},cancel:!0})},e.tips=function(t,n){return a({id:"Tips",zIndex:c(),title:!1,cancel:!1,fixed:!0,lock:!1}).content('<div style="padding: 0 1em;">'+t+"</div>").time(n||1.5)},t(function(){var o=e.dragEvent;if(o){var i=t(n),a=t(document),c=s?"absolute":"fixed",r=o.prototype,l=document.createElement("div"),d=l.style;d.cssText="display:none;position:"+c+";left:0;top:0;width:100%;height:100%;cursor:move;filter:alpha(opacity=0);opacity:0;background:#FFF",document.body.appendChild(l),r._start=r.start,r._end=r.end,r.start=function(){var t=e.focus.DOM,n=t.main[0],o=t.content[0].getElementsByTagName("iframe")[0];r._start.apply(this,arguments),d.display="block",d.zIndex=e.defaults.zIndex+3,"absolute"===c&&(d.width=i.width()+"px",d.height=i.height()+"px",d.left=a.scrollLeft()+"px",d.top=a.scrollTop()+"px"),o&&n.offsetWidth*n.offsetHeight>307200&&(n.style.visibility="")},r.end=function(){var t=e.focus;r._end.apply(this,arguments),d.display="none",t&&(t.DOM.main[0].style.visibility="visible")}}})}(this.art||this.jQuery,this,this.artDialog);