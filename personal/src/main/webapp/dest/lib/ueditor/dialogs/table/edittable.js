!function(){var e,t=$G("J_title"),o=$G("J_caption"),n=$G("J_sorttable"),i=$G("J_autoSizeContent"),a=$G("J_autoSizePage"),r=$G("J_tone"),l=$G("J_preview"),c=function(){e=this,e.init()};c.prototype={init:function(){var l=new UE.ui.ColorPicker({editor:editor}),c=new UE.ui.Popup({editor:editor,content:l});t.checked=editor.queryCommandState("inserttitle")==-1,o.checked=editor.queryCommandState("insertcaption")==-1,e.createTable(t.checked,o.checked),e.setAutoSize(),e.setColor(e.getColor()),domUtils.on(t,"click",e.titleHanler),domUtils.on(o,"click",e.captionHanler),domUtils.on(n,"click",e.sorttableHanler),domUtils.on(i,"click",e.autoSizeContentHanler),domUtils.on(a,"click",e.autoSizePageHanler),domUtils.on(r,"click",function(){c.showAnchor(r)}),domUtils.on(document,"mousedown",function(){c.hide()}),l.addListener("pickcolor",function(){e.setColor(arguments[1]),c.hide()}),l.addListener("picknocolor",function(){e.setColor(""),c.hide()})},createTable:function(e,t){var o=[];if(o.push("<table id='J_example'>"),t&&o.push("<caption>"+lang.captionName+"</caption>"),e){o.push("<tr>");for(var n=0;n<5;n++)o.push("<th>"+lang.titleName+"</th>");o.push("</tr>")}for(var i=0;i<6;i++){o.push("<tr>");for(var a=0;a<5;a++)o.push("<td>"+lang.cellsName+"</td>");o.push("</tr>")}o.push("</table>"),l.innerHTML=o.join("")},titleHanler:function(){var o=$G("J_example"),n=document.createDocumentFragment(),i=domUtils.getComputedStyle(domUtils.getElementsByTagName(o,"td")[0],"border-color");if(t.checked){o.insertRow(0);for(var a,r=0;r<5;r++)a=document.createElement("th"),a.innerHTML=lang.titleName,n.appendChild(a);o.rows[0].appendChild(n)}else domUtils.remove(o.rows[0]);e.setColor(i)},captionHanler:function(){var e=$G("J_example");if(o.checked){var t=document.createElement("caption");t.innerHTML=lang.captionName,e.insertBefore(t,e.firstChild)}else domUtils.remove(domUtils.getElementsByTagName(e,"caption")[0])},sorttableHanler:function(){var e=$G("J_example"),t=e.rows[0];if(n.checked)for(var o,i=0;o=t.cells[i++];){var a=document.createElement("span");a.innerHTML="^",o.appendChild(a)}else{var r=domUtils.getElementsByTagName(e,"span");utils.each(r,function(e){e.parentNode.removeChild(e)})}},autoSizeContentHanler:function(){var e=$G("J_example");e.removeAttribute("width")},autoSizePageHanler:function(){var e=$G("J_example"),t=e.getElementsByTagName(e,"td");utils.each(t,function(e){e.removeAttribute("width")}),e.setAttribute("width","100%")},getColor:function(){var e,t=editor.selection.getStart(),o=domUtils.findParentByTagName(t,["td","th","caption"],!0);return e=domUtils.getComputedStyle(o,"border-color"),e||(e="#DDDDDD"),e},setColor:function(e){var t=$G("J_example"),o=domUtils.getElementsByTagName(t,"td").concat(domUtils.getElementsByTagName(t,"th"),domUtils.getElementsByTagName(t,"caption"));r.value=e,utils.each(o,function(t){t.style.borderColor=e})},setAutoSize:function(){var e=this,t=editor.selection.getStart(),o=domUtils.findParentByTagName(t,"table",!0).width,n=!o;n?(i.checked=n,e.autoSizeContentHanler()):(a.checked=!n,e.autoSizePageHanler())}},new c,dialog.onok=function(){editor.__hasEnterExecCommand=!0;var e={title:"inserttitle deletetitle",caption:"insertcaption deletecaption",sorttable:"enablesort disablesort"};editor.fireEvent("saveScene");for(var t in e){var o=e[t].split(" "),n=$G("J_"+t);n.checked?editor.queryCommandState(o[0])!=-1&&editor.execCommand(o[0]):editor.queryCommandState(o[1])!=-1&&editor.execCommand(o[1])}editor.execCommand("edittable",r.value),i.checked?editor.execCommand("adaptbytext"):"",a.checked?editor.execCommand("adaptbywindow"):"",editor.fireEvent("saveScene"),editor.__hasEnterExecCommand=!1}}();