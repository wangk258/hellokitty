function changeSelected(e){e.getAttribute("selected")?(e.removeAttribute("selected"),e.style.cssText="filter:alpha(Opacity=100);-moz-opacity:1;opacity: 1;border: 2px solid #fff"):(e.setAttribute("selected","true"),e.style.cssText="filter:alpha(Opacity=50);-moz-opacity:0.5;opacity: 0.5;border:2px solid blue;"),$G("url").value=e.getAttribute("src")}function scale(e,t,o,n){var i,a=0,l=0,r=e.width||o,s=e.height||n;(r>t||s>t)&&(r>=s?(a=r-t)&&(i=(a/r).toFixed(2),e.height=s-s*i,e.width=t):(l=s-t)&&(i=(l/s).toFixed(2),e.width=r-r*i,e.height=t))}function initSelfPos(){var e,t;if(browser.ie)e=domUtils.getComputedStyle(doc.body,"background-position-x").replace(/50%|%|px|center/gi,""),t=domUtils.getComputedStyle(doc.body,"background-position-y").replace(/50%|%|px|center/gi,"");else{var o=domUtils.getComputedStyle(doc.body,"background-position").match(/\s?(\d*)px/gi);o&&o.length&&(e=o[0].replace("px",""),t=o[1].replace("px",""))}$G("x").value=e||0,$G("y").value=t||0}function initImgUrl(){var e=domUtils.getComputedStyle(doc.body,"background-image"),t="";e.indexOf(me.options.imagePath)>0?(t=e.match(/url\("?(.*[^\)"])"?/i),t&&t.length&&(t=t[1].substring(t[1].indexOf(me.options.imagePath),t[1].length))):t="none"!=e?e.replace(/url\("?|"?\)/gi,""):"",$G("url").value=t}function initAlign(){var e=domUtils.getComputedStyle(doc.body,"background-repeat"),t=$G("repeatType");if("no-repeat"==e){var o=domUtils.getComputedStyle(doc.body,browser.ie?"background-position-x":"background-position");t.value=o&&o.match(/\s?(\d*)px/gi)?"self":"center","center"==o&&(t.value="center"),$G("custom").style.display="self"==t.value?"":"none"}else t.value=e}function getCheckIpt(){for(var e,t=document.getElementsByName("t"),o=0;e=t[o++];)if(e.checked)return e.value}var me=editor,doc=me.document,bodyStyle,cp=$G("colorPicker"),bkbodyStyle="",bkcolor="",popup=new UE.ui.Popup({content:new UE.ui.ColorPicker({noColorText:me.getLang("clearColor"),editor:me,onpickcolor:function(e,t){domUtils.setStyle(cp,"background-color",t),bkcolor=t,UE.ui.Popup.postHide()},onpicknocolor:function(e,t){domUtils.setStyle(cp,"background-color","transparent"),bkcolor="",UE.ui.Popup.postHide()}}),editor:me,onhide:function(){setBody()}});domUtils.on(cp,"click",function(){popup.showAnchor(this)}),domUtils.on(document,"mousedown",function(e){var t=e.target||e.srcElement;UE.ui.Popup.postHide(t)}),domUtils.on(window,"scroll",function(){UE.ui.Popup.postHide()});var getHead=function(){return domUtils.getElementsByTagName($G("tabHeads"),"span")},bindClick=function(){for(var e,t=getHead(),o=0;e=t[o++];)e.onclick=function(){var e=this.getAttribute("tabsrc");if(toggleHead(this),toggleBody(e),"imgManager"==e)ajax.request(editor.options.imageManagerUrl,{timeout:1e5,action:"get",onsuccess:function(e){var t=utils.trim(e.responseText),o=t?t.split("ue_separate_ue"):[],n=o.length,i=$G("imageList");i.innerHTML=n?"":"&nbsp;&nbsp;"+lang.noUploadImage;for(var a,l=0;a=o[l++];){var r=document.createElement("img"),s=document.createElement("div");s.appendChild(r),s.style.display="none",i.appendChild(s),r.onclick=function(){for(var e,t=i.childNodes,o=0;e=t[o++];)e.firstChild.removeAttribute("selected"),e.firstChild.style.cssText="filter:alpha(Opacity=100);-moz-opacity:1;opacity: 1;border: 2px solid #fff";changeSelected(this)},r.onload=function(){this.parentNode.style.display="";var e=this.width,t=this.height;scale(this,95,120,80),this.title=lang.toggleSelect+e+"X"+t},r.setAttribute(l<35?"src":"lazy_src",editor.options.imageManagerPath+a.replace(/\s+|\s+/gi,"")),r.setAttribute("_src",editor.options.imageManagerPath+a.replace(/\s+|\s+/gi,""))}},onerror:function(){$G("imageList").innerHTML=lang.imageLoadError}});else for(var t,o=document.getElementsByName("t"),n=0;t=o[n++];)t.checked&&"none"!=t.value&&($G("repeatType").style.display="",net(t))}},toggleBody=function(e){for(var t,o=["normal","imgManager"],n=0;t=o[n++];)$G(t).style.zIndex=t==e?200:1},toggleHead=function(e){for(var t,o=getHead(),n=0;t=o[n++];)domUtils.removeClasses(t,["focus"]),$G("repeatType").style.display="none";domUtils.addClass(e,"focus")},getCheckedTab=function(){for(var e,t=getHead(),o=0;e=t[o++];)if(domUtils.hasClass(e,"focus"))return e},init=function(){bindClick();var e=getHead()[0],t=e.getAttribute("tabsrc");toggleHead(e),toggleBody(t),$G("alignment").style.display="none",$G("custom").style.display="none",domUtils.setStyle(cp,"background-color",domUtils.getComputedStyle(doc.body,"background-color"));var o=domUtils.getComputedStyle(doc.body,"background-color");(o&&"#ffffff"!=o&&"transparent"!=o||"none"!=domUtils.getComputedStyle(doc.body,"background-image"))&&setTimeout(function(){document.getElementsByName("t")[1].click()},200),initImgUrl(),initSelfPos(),initAlign()};init();var net=function(e){var t=$G("alignment"),o=$G("url"),n=$G("custom");"none"==e.value?(t.style.display="none",n.style.display="none",browser.ie?o.onpropertychange=null:o.removeEventListener("input",setBody)):(bindSelfPos(),$G("repeatType").style.display="",t.style.display="",browser.ie?o.onpropertychange=setBody:o.addEventListener("input",setBody,!1)),setBody()},bindSelfPos=function(){function e(e,t){e=e||event,38==e.keyCode||40==e.keyCode?(t.value=38==e.keyCode?parseInt(t.value)+1:parseInt(t.value)-1,t.value<0&&(t.value=0)):e.keyCode<48&&e.keyCode>57&&domUtils.preventDefault(e),setBody()}var t=$G("x"),o=$G("y");domUtils.on(t,["propertychange","input","keydown"],function(t){e(t,this)}),domUtils.on(o,["propertychange","input","keydown"],function(t){e(t,this)})},showAlign=function(){$G("alignment").style.display=""},selectAlign=function(e){$G("custom").style.display="self"==e.value?"":"none",setBody()},setBody=function(){var e=domUtils.getStyle(cp,"background-color"),t=$G("url").value,o=$G("repeatType").value,n={"background-repeat":"no-repeat","background-position":"center center"},i=[];switch(e&&(n["background-color"]=e),t&&(n["background-image"]='url("'+t+'")'),o){case"repeat-x":n["background-repeat"]="repeat-x;";break;case"repeat-y":n["background-repeat"]="repeat-y;";break;case"repeat":n["background-repeat"]="repeat;";break;case"self":n["background-position"]=$G("x").value+"px "+$G("y").value+"px"}for(var a in n)n.hasOwnProperty(a)&&i.push(a+":"+n[a]);"none"!=getCheckIpt()?utils.cssRule("body","body{"+i.join(";")+"}",doc):utils.cssRule("body","",doc)};dialog.onok=function(){setBody()},dialog.oncancel=function(){utils.cssRule("body",bkbodyStyle,doc)},bkbodyStyle=utils.cssRule("body",void 0,doc);